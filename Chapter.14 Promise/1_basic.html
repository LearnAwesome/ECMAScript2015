<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
        
        // 基本用法
        // new Promise((resolve, reject) => {})

        // 基本例子
        // function timeout(ms) {
        //     return new Promise((resolve, reject) => {
        //         setTimeout((res) => {
        //             resolve(res);
        //         }, ms, "done");
        //     });
        // }
        // timeout(1000).then((value) => {
        //     console.log(value); // "done"
        // });

        // 加载图片
        // const loadImageAsync = (url) => {
        //     return new Promise((resolve, reject) => {
        //         const _image = new Image();
        //         _image.onload = () => {
        //             resolve(_image);
        //         };
        //         _image.onerror = () => {
        //             reject( new Error( `Could not load image at ${ url }` ) );
        //         };
        //         _image.src = url;
        //     });
        // };
        // const imgUrl = "http://blog.lujingtao.com/2017/11/20/hexo-theme/theme_1.png";
        // loadImageAsync(imgUrl)
        //     .then((res) => {
        //         console.log(res);
        //     });

        // AJAX - GET
        // function getJSON (url) {
        //     return promise = new Promise( (resolve, reject) => {
        //         const _client = new XMLHttpRequest();
        //         _client.open("GET", url);
        //         _client.onreadystatechange = _handler;
        //         _client.responseType = "json";
        //         _client.setRequestHeader("Accept", "application/json");
        //         _client.send();

        //         function _handler() {
        //             if (this.readyState !== 4) return;
        //             if (this.status === 200) {
        //                 resolve({
        //                     code: this.status,
        //                     data: this.response
        //                 });
        //             } else {
        //                 reject( new Error(this.statusText) );
        //             }
        //         }
        //     });
        // }
        // const url = "src/ajax.json";
        // getJSON(url)
        //     .then((res) => {
        //         console.log(res);
        //     }, (error) => {
        //         console.error(error);
        //     });

        // 异步嵌套
        // const p1 = new Promise((resolve, reject) => {
        //     console.log("p1 is running.");
        //     setTimeout( () => {
        //         console.log("p1 is finished.");
        //         reject( new Error( `fail in p1` ) );
        //     }, 3000 );
        // });
        // const p2 = new Promise((resolve, reject) => {
        //     console.log("p2 is running.")
        //     setTimeout( () => {
        //         console.log("p2 is waiting for p1 finished.")
        //         resolve( p1 );
        //     }, 1000);
        // });
        // p2.then(res => {
        //     console.log(res)
        // }).catch(err => {
        //     console.error(err);
        // });

    </script>
</body>
</html>